# 部屋のリモコンをキーホルダーにする
リモコンをよく無くすので、暗い中帰ってきても探さなくて良いようにしよう<br>

## 手順
1. リモコンの信号を解析(ライブラリ使わず自力でやってみる)<br>
->ロジアナで解析　完了<br>

1. 信号をIR LEDで再現　完了<br>
1. ソーラーキーライトを改造して組み込む<br>

## やっときたいこと
1. ボタンを押しやすいように<br>
1. オンオフを同じボタンで<br>
1. 指向性!<br>
1. LED1つはそのまま、もう1つだけを赤外線に変える<br>

---
## 部品など 
- Attiny85@internal 1MHz(省電力)
- IR LED - 詳細は謎。安物なので一般的なやつのデータシートを参考に
- 2sc1815 Yランク - LED駆動用
- 抵抗 - 22ohm(LED電流調整)、10kohm(トランジスタプルダウン)、2.2kohm(ベース電流制限)
- タクトスイッチ - キーライトの流用が難しそうなので。
- LED ソーラーキーライト - Ni-MH 3.6V/40mAh入り！！


---
## メモ
受信モジュールで取得した信号は家電協会のフォーマットだが、<br>
実際に送信している信号の、on時間0.4msは38kHzの搬送波<br>
38kHz -> 26.3usなので、8.7us,17.5us のduty<br>

電流不足
電圧変動を抑えるために、コンデンサを入れる<br>
ケースの都合から、10V/100uFを使用<br>
赤外線LEDはパルスで駆動するため、電流は結構流していい<br>

ATTINY85は3.6V動作させる<br>
使う機能は、スリープ、PWM、ピン割り込み<br>
省電力のため、未使用品はプルアップ<br>

使ってるLEDは謎<br>
5V時、Vf=1.23V<br>
50~100mAで駆動する?<br>



---
## 詰まったところ  
arduinoのdelayMicroseconds()、avr/delay.hの_delay_ms()は遅延がきつい<br>
arduinoのmicros()を用いてdelay関数を自作<br>
<br>
なぜか赤外線の受信後の信号で、onになるまで若干のラグ<br>
off時間を-70us、on時間を+70usして対処<br>
<br>
attiny85はsoftware serialが意外と使える<br>
<br>
PB5はRESETに設定(ヒューズビットで指定)されてると使えない<br>
<br>
2SC1815Yのデータシート、Icを100mAとかにするとhFEが超下がる<br>
<br>

---
## 最終的な仕様
ハードはそのまま<br>
<br>
LEDの頭を削っても指向性がつよつよなので、ソフトで対処<br>
<br>
具体的には、おまけの白LEDで、ONとOFFの見分けがつくようにして、<br>
シーリングライトが切り替えるまで押しっぱ<br>